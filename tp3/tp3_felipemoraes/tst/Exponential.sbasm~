// ; Reads the a number n from the keyboard 
// ; and prints its fatorial
		// ; Gets N
MAIN: INPUT RA
		INPUT RB
		// ; Calculates RA^RB
		CALL POW
		// ; Prints results and exit
		PRINT RA
		HALT
// ; Does RA = RA^RB
		// ; Saves used registers
POW: PUSH RB
		PUSH RC
		PUSH RD
		// ; Set initial values
		RD=1
		RC=1
		// ; Apply product for each 1-bit in exponent
		// ; While there are still bits to compute in RB
		IF!(RB)GOTO pX
			// ; Find a valid bit
			IF(RB&RC)GOTO p1
			p0:	CALL SQUARE
				RC<<=1
				IF!(RB&RC)GOTO p0
			// ; Apply product
		p1:	PUSH RB
			RB=RA
			RA=RD
			CALL MUL
			RD=RA
			RA=RB
			POP RB
			// ; Unset bit in RB
			RB-=RC
			IF(RB)GOTO p0
	// ; Restore registers and return
	pX: RA=RD
		POP RD
		POP RC
		POP RB
		RET
//
//
// ; Does RA = RA * RA
SQUARE:	PUSH RB 
		RB=RA
		CALL MUL
		POP RB
		RET
//
//
// ; Does RA = RA * RB
		// ; Saves used registers
MUL: PUSH RB 
		PUSH RC 
		PUSH RD	
		// ; Sets initial values
		RD=RA						
		RC=1				
		RA=0						
		// ; While RB == 0, loop
		IF!(RB)GOTO mX
			// ; Find a valid bit in RB
			IF(RB&RC)GOTO m1
			m2:	RC<<=1				
				RD<<=1				
				IF!(RB&RC)GOTO m2
			// ; Once a valid bit was found, use value
		m1:	RA+=RD
			RB-=RC
			IF(RB)GOTO m2
	// ; Restore values and exit
	mX:	POP RD	
		POP RC
		POP RB
		RET
//: BEGINMACRO
ENDMACRO
PRINT: BEGINMACRO REG
	STORE MACROAUX REG
	WRITE MACROAUX
ENDMACRO
INPUT: BEGINMACRO REG
	READ MACROAUX
	LOAD REG MACROAUX
ENDMACRO
RA=0: BEGINMACRO
	XOR	RA	RA
ENDMACRO
RB=0: BEGINMACRO
	XOR	RB	RB
ENDMACRO
RC=0: BEGINMACRO
	XOR	RC	RC
ENDMACRO
RD=0: BEGINMACRO
	XOR	RD	RD
ENDMACRO
RA=1: BEGINMACRO
	LOAD	RA	ONE
ENDMACRO
RB=1: BEGINMACRO
	LOAD	RB	ONE
ENDMACRO
RC=1: BEGINMACRO
	LOAD	RC	ONE
ENDMACRO
RD=1: BEGINMACRO
	LOAD	RD	ONE
ENDMACRO
RA<<=1: BEGINMACRO
	ADD	RA	RA
ENDMACRO
RB<<=1: BEGINMACRO
	ADD	RB	RB
ENDMACRO
RC<<=1: BEGINMACRO
	ADD	RC	RC
ENDMACRO
RD<<=1: BEGINMACRO
	ADD	RD	RD
ENDMACRO
RA=RA: BEGINMACRO
	MOVE	RA	RA
ENDMACRO
RA=RB: BEGINMACRO
	MOVE	RA	RB
ENDMACRO
RA=RC: BEGINMACRO
	MOVE	RA	RC
ENDMACRO
RA=RD: BEGINMACRO
	MOVE	RA	RD
ENDMACRO
RB=RA: BEGINMACRO
	MOVE	RB	RA
ENDMACRO
RB=RB: BEGINMACRO
	MOVE	RB	RB
ENDMACRO
RB=RC: BEGINMACRO
	MOVE	RB	RC
ENDMACRO
RB=RD: BEGINMACRO
	MOVE	RB	RD
ENDMACRO
RC=RA: BEGINMACRO
	MOVE	RC	RA
ENDMACRO
RC=RB: BEGINMACRO
	MOVE	RC	RB
ENDMACRO
RC=RC: BEGINMACRO
	MOVE	RC	RC
ENDMACRO
RC=RD: BEGINMACRO
	MOVE	RC	RD
ENDMACRO
RD=RA: BEGINMACRO
	MOVE	RD	RA
ENDMACRO
RD=RB: BEGINMACRO
	MOVE	RD	RB
ENDMACRO
RD=RC: BEGINMACRO
	MOVE	RD	RC
ENDMACRO
RD=RD: BEGINMACRO
	MOVE	RD	RD
ENDMACRO
RA+=RA: BEGINMACRO
	ADD	RA	RA
ENDMACRO
RA+=RB: BEGINMACRO
	ADD	RA	RB
ENDMACRO
RA+=RC: BEGINMACRO
	ADD	RA	RC
ENDMACRO
RA+=RD: BEGINMACRO
	ADD	RA	RD
ENDMACRO
RB+=RA: BEGINMACRO
	ADD	RB	RA
ENDMACRO
RB+=RB: BEGINMACRO
	ADD	RB	RB
ENDMACRO
RB+=RC: BEGINMACRO
	ADD	RB	RC
ENDMACRO
RB+=RD: BEGINMACRO
	ADD	RB	RD
ENDMACRO
RC+=RA: BEGINMACRO
	ADD	RC	RA
ENDMACRO
RC+=RB: BEGINMACRO
	ADD	RC	RB
ENDMACRO
RC+=RC: BEGINMACRO
	ADD	RC	RC
ENDMACRO
RC+=RD: BEGINMACRO
	ADD	RC	RD
ENDMACRO
RD+=RA: BEGINMACRO
	ADD	RD	RA
ENDMACRO
RD+=RB: BEGINMACRO
	ADD	RD	RB
ENDMACRO
RD+=RC: BEGINMACRO
	ADD	RD	RC
ENDMACRO
RD+=RD: BEGINMACRO
	ADD	RD	RD
ENDMACRO
RA-=RA: BEGINMACRO
	SUB	RA	RA
ENDMACRO
RA-=RB: BEGINMACRO
	SUB	RA	RB
ENDMACRO
RA-=RC: BEGINMACRO
	SUB	RA	RC
ENDMACRO
RA-=RD: BEGINMACRO
	SUB	RA	RD
ENDMACRO
RB-=RA: BEGINMACRO
	SUB	RB	RA
ENDMACRO
RB-=RB: BEGINMACRO
	SUB	RB	RB
ENDMACRO
RB-=RC: BEGINMACRO
	SUB	RB	RC
ENDMACRO
RB-=RD: BEGINMACRO
	SUB	RB	RD
ENDMACRO
RC-=RA: BEGINMACRO
	SUB	RC	RA
ENDMACRO
RC-=RB: BEGINMACRO
	SUB	RC	RB
ENDMACRO
RC-=RC: BEGINMACRO
	SUB	RC	RC
ENDMACRO
RC-=RD: BEGINMACRO
	SUB	RC	RD
ENDMACRO
RD-=RA: BEGINMACRO
	SUB	RD	RA
ENDMACRO
RD-=RB: BEGINMACRO
	SUB	RD	RB
ENDMACRO
RD-=RC: BEGINMACRO
	SUB	RD	RC
ENDMACRO
RD-=RD: BEGINMACRO
	SUB	RD	RD
ENDMACRO
IF(RA==RA)GOTO: BEGINMACRO POS
	TEST	RA	RA
	BEZ POS
ENDMACRO
IF(RA==RB)GOTO: BEGINMACRO POS
	TEST	RA	RB
	BEZ POS
ENDMACRO
IF(RA==RC)GOTO: BEGINMACRO POS
	TEST	RA	RC
	BEZ POS
ENDMACRO
IF(RA==RD)GOTO: BEGINMACRO POS
	TEST	RA	RD
	BEZ POS
ENDMACRO
IF(RB==RA)GOTO: BEGINMACRO POS
	TEST	RB	RA
	BEZ POS
ENDMACRO
IF(RB==RB)GOTO: BEGINMACRO POS
	TEST	RB	RB
	BEZ POS
ENDMACRO
IF(RB==RC)GOTO: BEGINMACRO POS
	TEST	RB	RC
	BEZ POS
ENDMACRO
IF(RB==RD)GOTO: BEGINMACRO POS
	TEST	RB	RD
	BEZ POS
ENDMACRO
IF(RC==RA)GOTO: BEGINMACRO POS
	TEST	RC	RA
	BEZ POS
ENDMACRO
IF(RC==RB)GOTO: BEGINMACRO POS
	TEST	RC	RB
	BEZ POS
ENDMACRO
IF(RC==RC)GOTO: BEGINMACRO POS
	TEST	RC	RC
	BEZ POS
ENDMACRO
IF(RC==RD)GOTO: BEGINMACRO POS
	TEST	RC	RD
	BEZ POS
ENDMACRO
IF(RD==RA)GOTO: BEGINMACRO POS
	TEST	RD	RA
	BEZ POS
ENDMACRO
IF(RD==RB)GOTO: BEGINMACRO POS
	TEST	RD	RB
	BEZ POS
ENDMACRO
IF(RD==RC)GOTO: BEGINMACRO POS
	TEST	RD	RC
	BEZ POS
ENDMACRO
IF(RD==RD)GOTO: BEGINMACRO POS
	TEST	RD	RD
	BEZ POS
ENDMACRO
IF(RA!=RA)GOTO: BEGINMACRO POS
	TEST	RA	RA
	BNZ POS
ENDMACRO
IF(RA!=RB)GOTO: BEGINMACRO POS
	TEST	RA	RB
	BNZ POS
ENDMACRO
IF(RA!=RC)GOTO: BEGINMACRO POS
	TEST	RA	RC
	BNZ POS
ENDMACRO
IF(RA!=RD)GOTO: BEGINMACRO POS
	TEST	RA	RD
	BNZ POS
ENDMACRO
IF(RB!=RA)GOTO: BEGINMACRO POS
	TEST	RB	RA
	BNZ POS
ENDMACRO
IF(RB!=RB)GOTO: BEGINMACRO POS
	TEST	RB	RB
	BNZ POS
ENDMACRO
IF(RB!=RC)GOTO: BEGINMACRO POS
	TEST	RB	RC
	BNZ POS
ENDMACRO
IF(RB!=RD)GOTO: BEGINMACRO POS
	TEST	RB	RD
	BNZ POS
ENDMACRO
IF(RC!=RA)GOTO: BEGINMACRO POS
	TEST	RC	RA
	BNZ POS
ENDMACRO
IF(RC!=RB)GOTO: BEGINMACRO POS
	TEST	RC	RB
	BNZ POS
ENDMACRO
IF(RC!=RC)GOTO: BEGINMACRO POS
	TEST	RC	RC
	BNZ POS
ENDMACRO
IF(RC!=RD)GOTO: BEGINMACRO POS
	TEST	RC	RD
	BNZ POS
ENDMACRO
IF(RD!=RA)GOTO: BEGINMACRO POS
	TEST	RD	RA
	BNZ POS
ENDMACRO
IF(RD!=RB)GOTO: BEGINMACRO POS
	TEST	RD	RB
	BNZ POS
ENDMACRO
IF(RD!=RC)GOTO: BEGINMACRO POS
	TEST	RD	RC
	BNZ POS
ENDMACRO
IF(RD!=RD)GOTO: BEGINMACRO POS
	TEST	RD	RD
	BNZ POS
ENDMACRO
IF(RA<RA)GOTO: BEGINMACRO POS
	COMP	RA	RA
	BLZ POS
ENDMACRO
IF(RA<RB)GOTO: BEGINMACRO POS
	COMP	RA	RB
	BLZ POS
ENDMACRO
IF(RA<RC)GOTO: BEGINMACRO POS
	COMP	RA	RC
	BLZ POS
ENDMACRO
IF(RA<RD)GOTO: BEGINMACRO POS
	COMP	RA	RD
	BLZ POS
ENDMACRO
IF(RB<RA)GOTO: BEGINMACRO POS
	COMP	RB	RA
	BLZ POS
ENDMACRO
IF(RB<RB)GOTO: BEGINMACRO POS
	COMP	RB	RB
	BLZ POS
ENDMACRO
IF(RB<RC)GOTO: BEGINMACRO POS
	COMP	RB	RC
	BLZ POS
ENDMACRO
IF(RB<RD)GOTO: BEGINMACRO POS
	COMP	RB	RD
	BLZ POS
ENDMACRO
IF(RC<RA)GOTO: BEGINMACRO POS
	COMP	RC	RA
	BLZ POS
ENDMACRO
IF(RC<RB)GOTO: BEGINMACRO POS
	COMP	RC	RB
	BLZ POS
ENDMACRO
IF(RC<RC)GOTO: BEGINMACRO POS
	COMP	RC	RC
	BLZ POS
ENDMACRO
IF(RC<RD)GOTO: BEGINMACRO POS
	COMP	RC	RD
	BLZ POS
ENDMACRO
IF(RD<RA)GOTO: BEGINMACRO POS
	COMP	RD	RA
	BLZ POS
ENDMACRO
IF(RD<RB)GOTO: BEGINMACRO POS
	COMP	RD	RB
	BLZ POS
ENDMACRO
IF(RD<RC)GOTO: BEGINMACRO POS
	COMP	RD	RC
	BLZ POS
ENDMACRO
IF(RD<RD)GOTO: BEGINMACRO POS
	COMP	RD	RD
	BLZ POS
ENDMACRO
IF(RA<RA)GOTO: BEGINMACRO POS
	COMP	RA	RA
	BLZ POS
ENDMACRO
IF(RA<RB)GOTO: BEGINMACRO POS
	COMP	RB	RA
	BLZ POS
ENDMACRO
IF(RA<RC)GOTO: BEGINMACRO POS
	COMP	RC	RA
	BLZ POS
ENDMACRO
IF(RA<RD)GOTO: BEGINMACRO POS
	COMP	RD	RA
	BLZ POS
ENDMACRO
IF(RB<RA)GOTO: BEGINMACRO POS
	COMP	RA	RB
	BLZ POS
ENDMACRO
IF(RB<RB)GOTO: BEGINMACRO POS
	COMP	RB	RB
	BLZ POS
ENDMACRO
IF(RB<RC)GOTO: BEGINMACRO POS
	COMP	RC	RB
	BLZ POS
ENDMACRO
IF(RB<RD)GOTO: BEGINMACRO POS
	COMP	RD	RB
	BLZ POS
ENDMACRO
IF(RC<RA)GOTO: BEGINMACRO POS
	COMP	RA	RC
	BLZ POS
ENDMACRO
IF(RC<RB)GOTO: BEGINMACRO POS
	COMP	RB	RC
	BLZ POS
ENDMACRO
IF(RC<RC)GOTO: BEGINMACRO POS
	COMP	RC	RC
	BLZ POS
ENDMACRO
IF(RC<RD)GOTO: BEGINMACRO POS
	COMP	RD	RC
	BLZ POS
ENDMACRO
IF(RD<RA)GOTO: BEGINMACRO POS
	COMP	RA	RD
	BLZ POS
ENDMACRO
IF(RD<RB)GOTO: BEGINMACRO POS
	COMP	RB	RD
	BLZ POS
ENDMACRO
IF(RD<RC)GOTO: BEGINMACRO POS
	COMP	RC	RD
	BLZ POS
ENDMACRO
IF(RD<RD)GOTO: BEGINMACRO POS
	COMP	RD	RD
	BLZ POS
ENDMACRO
IF(RA&RA)GOTO: BEGINMACRO POS
	TEST	RA	RA
	BNZ POS
ENDMACRO
IF(RA&RB)GOTO: BEGINMACRO POS
	TEST	RA	RB
	BNZ POS
ENDMACRO
IF(RA&RC)GOTO: BEGINMACRO POS
	TEST	RA	RC
	BNZ POS
ENDMACRO
IF(RA&RD)GOTO: BEGINMACRO POS
	TEST	RA	RD
	BNZ POS
ENDMACRO
IF(RB&RA)GOTO: BEGINMACRO POS
	TEST	RB	RA
	BNZ POS
ENDMACRO
IF(RB&RB)GOTO: BEGINMACRO POS
	TEST	RB	RB
	BNZ POS
ENDMACRO
IF(RB&RC)GOTO: BEGINMACRO POS
	TEST	RB	RC
	BNZ POS
ENDMACRO
IF(RB&RD)GOTO: BEGINMACRO POS
	TEST	RB	RD
	BNZ POS
ENDMACRO
IF(RC&RA)GOTO: BEGINMACRO POS
	TEST	RC	RA
	BNZ POS
ENDMACRO
IF(RC&RB)GOTO: BEGINMACRO POS
	TEST	RC	RB
	BNZ POS
ENDMACRO
IF(RC&RC)GOTO: BEGINMACRO POS
	TEST	RC	RC
	BNZ POS
ENDMACRO
IF(RC&RD)GOTO: BEGINMACRO POS
	TEST	RC	RD
	BNZ POS
ENDMACRO
IF(RD&RA)GOTO: BEGINMACRO POS
	TEST	RD	RA
	BNZ POS
ENDMACRO
IF(RD&RB)GOTO: BEGINMACRO POS
	TEST	RD	RB
	BNZ POS
ENDMACRO
IF(RD&RC)GOTO: BEGINMACRO POS
	TEST	RD	RC
	BNZ POS
ENDMACRO
IF(RD&RD)GOTO: BEGINMACRO POS
	TEST	RD	RD
	BNZ POS
ENDMACRO
IF!(RA&RA)GOTO: BEGINMACRO POS
	TEST	RA	RA
	BEZ POS
ENDMACRO
IF!(RA&RB)GOTO: BEGINMACRO POS
	TEST	RA	RB
	BEZ POS
ENDMACRO
IF!(RA&RC)GOTO: BEGINMACRO POS
	TEST	RA	RC
	BEZ POS
ENDMACRO
IF!(RA&RD)GOTO: BEGINMACRO POS
	TEST	RA	RD
	BEZ POS
ENDMACRO
IF!(RB&RA)GOTO: BEGINMACRO POS
	TEST	RB	RA
	BEZ POS
ENDMACRO
IF!(RB&RB)GOTO: BEGINMACRO POS
	TEST	RB	RB
	BEZ POS
ENDMACRO
IF!(RB&RC)GOTO: BEGINMACRO POS
	TEST	RB	RC
	BEZ POS
ENDMACRO
IF!(RB&RD)GOTO: BEGINMACRO POS
	TEST	RB	RD
	BEZ POS
ENDMACRO
IF!(RC&RA)GOTO: BEGINMACRO POS
	TEST	RC	RA
	BEZ POS
ENDMACRO
IF!(RC&RB)GOTO: BEGINMACRO POS
	TEST	RC	RB
	BEZ POS
ENDMACRO
IF!(RC&RC)GOTO: BEGINMACRO POS
	TEST	RC	RC
	BEZ POS
ENDMACRO
IF!(RC&RD)GOTO: BEGINMACRO POS
	TEST	RC	RD
	BEZ POS
ENDMACRO
IF!(RD&RA)GOTO: BEGINMACRO POS
	TEST	RD	RA
	BEZ POS
ENDMACRO
IF!(RD&RB)GOTO: BEGINMACRO POS
	TEST	RD	RB
	BEZ POS
ENDMACRO
IF!(RD&RC)GOTO: BEGINMACRO POS
	TEST	RD	RC
	BEZ POS
ENDMACRO
IF!(RD&RD)GOTO: BEGINMACRO POS
	TEST	RD	RD
	BEZ POS
ENDMACRO
IF(RA)GOTO: BEGINMACRO POS
	TEST	RA	RA
	BNZ POS
ENDMACRO
IF(RB)GOTO: BEGINMACRO POS
	TEST	RB	RB
	BNZ POS
ENDMACRO
IF(RC)GOTO: BEGINMACRO POS
	TEST	RC	RC
	BNZ POS
ENDMACRO
IF(RD)GOTO: BEGINMACRO POS
	TEST	RD	RD
	BNZ POS
ENDMACRO
IF!(RA)GOTO: BEGINMACRO POS
	TEST	RA	RA
	BEZ POS
ENDMACRO
IF!(RB)GOTO: BEGINMACRO POS
	TEST	RB	RB
	BEZ POS
ENDMACRO
IF!(RC)GOTO: BEGINMACRO POS
	TEST	RC	RC
	BEZ POS
ENDMACRO
IF!(RD)GOTO: BEGINMACRO POS
	TEST	RD	RD
	BEZ POS
ENDMACRO
SWAP_RA: BEGINMACRO REG2
	XOR	RA	REG2
	XOR	REG2	RA
	XOR	RA	REG2
ENDMACRO
SWAP_RB: BEGINMACRO REG2
	XOR	RB	REG2
	XOR	REG2	RB
	XOR	RB	REG2
ENDMACRO
SWAP_RC: BEGINMACRO REG2
	XOR	RC	REG2
	XOR	REG2	RC
	XOR	RC	REG2
ENDMACRO
SWAP_RD: BEGINMACRO REG2
	XOR	RD	REG2
	XOR	REG2	RD
	XOR	RD	REG2
ENDMACRO
ONE: WORD 1
MACROAUX: WORD 1
END
